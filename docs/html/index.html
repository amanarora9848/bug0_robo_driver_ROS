<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>bug0_robo_driver_ROS: Research Track 1 - Assignment 2 (UniGe)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">bug0_robo_driver_ROS
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Client ROS package for an action server to move a mobile robot using bug0 algorithm present at https://github.com/CarmineD8/assignment_2_2022</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Research Track 1 - Assignment 2 (UniGe) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is a client package for the package <a href="https://github.com/CarmineD8/assignment_2_2022">assignment_2_2022</a> that provides an implementation of an action server, that moves a robot in the environment by implementing the bug0 algorithm. This is the 2nd asignment as part of the course: <b>Research Track 1</b> at the University of Genoa, Italy.</p>
<h1><a class="anchor" id="autotoc_md0"></a>
Goals and Overview:</h1>
<p>Three (or four) principle nodes have been developed as part of this package:</p><ul>
<li><b>Node 1a</b> (<code>target_info_client_node</code>)<ul>
<li>Implements an action client, allowing the user to set a target position (x, y), or cancel it.</li>
</ul>
</li>
<li><b>Node 1b</b> (<code>robot_status_pub_node</code>)<ul>
<li>This node subscribes to <code>/odom</code> topic and publishes the retrieved position and velocity values using a custom ROS message (<code>RoboStatusMsg.msg</code>) to the topic <code>/robot/robo_stats</code>.</li>
</ul>
</li>
<li><b>Node 2</b> (<code>goal_info_srv_node</code>)<ul>
<li>This ROS service node serves the number of goals reached by the robot and cancelled by the user. To get the number of goals, this subscibes to the topic <code>/reaching_goal_result</code> and increments each value accordingly, depending on the returned status of the robot reaching goal or not.</li>
</ul>
</li>
<li><b>Node 3</b> (<code>robo_info_node</code>)<ul>
<li>This node subscribes to the topic <code>/robot/robo_stats</code> to obtain robot's position and velocity using our custom message and displays these parameters along with robot's distance from goal and average speed.</li>
</ul>
</li>
</ul>
<p>In addition to these, in order to show the implementation of a ROS Service-Client, a node: (<code>disp_goals_node</code>) has also been created, that calls the Service Server node <code>goal_info_srv_node</code> and prints the number of goals reached and cancelled.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Requirements</h1>
<p>The overall project has been well tested using ROS Noetic and requires RViz and Gazebo for simulation and physics.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Directory Structure [Package: unige_rt1_assignment2]</h1>
<div class="fragment"><div class="line">.</div>
<div class="line">|-- CMakeLists.txt</div>
<div class="line">|-- LICENSE</div>
<div class="line">|-- README.md</div>
<div class="line">|-- config</div>
<div class="line">|   `-- robot.yaml</div>
<div class="line">|-- images</div>
<div class="line">|   `-- rosgraph.png</div>
<div class="line">|-- launch</div>
<div class="line">|   `-- complete_sim.launch</div>
<div class="line">|-- msg</div>
<div class="line">|   `-- RoboStatusMsg.msg</div>
<div class="line">|-- package.xml</div>
<div class="line">|-- src</div>
<div class="line">|   |-- disp_goals.cpp</div>
<div class="line">|   |-- goal_info_srv.cpp</div>
<div class="line">|   |-- robo_info.cpp</div>
<div class="line">|   |-- robot_status_pub.cpp</div>
<div class="line">|   `-- target_info_client.cpp</div>
<div class="line">`-- srv</div>
<div class="line">    `-- GoalInfo.srv</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md3"></a>
Running the full simulation:</h1>
<h3><a class="anchor" id="autotoc_md4"></a>
Update and upgrade packages:</h3>
<div class="fragment"><div class="line">sudo apt update &amp;&amp; sudo apt upgrade</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md5"></a>
First, we need to build a catkin workspace for the project. Navigate to preferred directory, then:</h3>
<div class="fragment"><div class="line">mkdir -p bug0robo_catkin_workspace/src/</div>
<div class="line">cd bug0robo_catkin_workspace/src/</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md6"></a>
Initialize the catkin workspace:</h3>
<div class="fragment"><div class="line">catkin_init_workspace</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md7"></a>
Now clone this repo and the action server repo (assuming user has ssh-auth setup):</h3>
<div class="fragment"><div class="line">git clone git@github.com:amanarora9848/unige_rt1_assignment2.git</div>
<div class="line">git clone git@github.com:CarmineD8/assignment_2_2022.git</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md8"></a>
Navigate back to base directory &lt;tt&gt;bug0robo_catkin_workspace&lt;/tt&gt;</h3>
<div class="fragment"><div class="line">cd ..</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md9"></a>
Run &lt;tt&gt;catkin_make&lt;/tt&gt; to build the package:</h3>
<div class="fragment"><div class="line">catkin_make</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md10"></a>
Source &lt;tt&gt;setup.bash&lt;/tt&gt; to set the environment variables used by ROS</h3>
<div class="fragment"><div class="line">source devel/setup.bash</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md11"></a>
Launch the complete simulation. The launch file for this can be found in &lt;tt&gt;/src/unige_rt1_assignment2/launch/complete_sim.launch&lt;/tt&gt; relative to the current diretory:</h3>
<div class="fragment"><div class="line">roslaunch unige_rt1_assignment2 complete_sim.launch</div>
</div><!-- fragment --><p>Using this command launches the simulation (particularly the node-C at the default rate of 5 /sec). This can be changed by also passing an argument parameter, for example:</p>
<div class="fragment"><div class="line">***Here is an example of the simulation running:</div>
<div class="line">[Implementation Video](https://youtu.be/TDBa1oudBaU)***</div>
<div class="line"> </div>
<div class="line">## Project Explanation and Implementation</div>
<div class="line"> </div>
<div class="line">### ROS rqt-graph (with nodes and topics) for the whole project (client-server)</div>
<div class="line"> </div>
<div class="line">&lt;img src=&quot;images/rosgraph.png&quot; alt=&quot;rqt-graph&quot;&gt;</div>
<div class="line"> </div>
<div class="line">&lt;!-- [rqt-graph](images/rosgraph.png) --&gt;</div>
<div class="line"> </div>
<div class="line">### ROS Nodes in detail:</div>
<div class="line"> </div>
<div class="line">This package uses 4 + 1 nodes for the task to be done effectively and holistically. They are `target_info_client_node`, `robot_status_pub_node`, `goal_info_srv_node`, `robo_info_node` and 1 extra node: `disp_goals_node`. </div>
<div class="line"> </div>
<div class="line">- As seen from the rqt-graph, the action client node `target_info_client_node` interacts with the action server defined in the package `assignment_2_2022` using the `Planning.action` file, in which are defined the action goal and feedback messages.</div>
<div class="line"> </div>
<div class="line">    - The pseudocode for this node is given below:</div>
</div><!-- fragment --> <pre class="fragment">while ros is running:
    take user input to proceed or cancel goal

    if input is proceed:
        if cancel command passed before (is in stack):
            pop cancel command from stack
        end
        take user input for x and y
        send goal to action server
        set goal in parameter server variables
    else if input is cancel:
        if cancel not passed before: // stack is empty
            push cancel command to stack
            if action server status is executing goal:
                send cancel to action server
            else:
                prohibit cancel command
            end
        else if cancel in stack:
            prohibit cancel command
        end
    else:
        tell user that input is invalid
    end

```
</pre><ul>
<li><p class="startli">The <code>robot_status_pub_node</code> subscribes to the <code>/odom</code> topic for position and velocity of the robot and publishes them at the topic <code>/robot/robo_stats</code>.</p><ul>
<li>The pseudocode for this node is given below: ``` subscribe to /odom topic check for /odom callbacks set x, y, vel_x, vel_y in callbacks while ros is running: set user x, y, vel_x, vel_y obtained from /odom publish these as custom message to /robot/robo_stats topic at user defined rate</li>
</ul>
<p class="startli">```</p><ul>
<li>Given below is the custom message definition. ``` </li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md12"></a>
A custom message for robot position and velocity</h1>
<p>float32 pos_x float32 pos_y float32 vel_x float32 vel_y ```</p>
<ul>
<li>The node <code>robo_info_node</code> recieves these robot position and velocity values by subscribing to the <code>/robot/robo_stats</code>, along with obtaining the user-given goal position from the parameter server. The parameter server variables have been configured in the configuration file <code>robot.yaml</code> present in the <em><b>config</b></em> folder. ```yaml robot: { goal_pos_param: { x_goal: 0, y_goal: 0 } } ```<ul>
<li>Using these values, the distance to the goal and theaverage velocities are calculated.</li>
</ul>
</li>
<li><p class="startli">The node <code>goal_info_srv_node</code> also interacts with the action server messages and receives the status message (<code>assignment_2_2022::PlanningActionResult::ConstPtr&amp; msg</code>) from it, to determine the number of goals reached or cancelled.</p><ul>
<li>The pseudocode for this node: ``` Declare service goal_service</li>
</ul>
<p class="startli">Subscribe to /reaching_goal/result topic from action server Check for /reaching_goal/result callbacks</p>
<p class="startli">if goal is completed: goals_reached_number = goals_reached_number + 1 else if goal is cancelled: goals_cancelled_number = goals_cancelled_number + 1 end</p>
<p class="startli">Define service response message Advertise /goals_service service ```</p><ul>
<li>Given below is the service (srv) file definition. </li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md13"></a>
```</h2>
<p>string msg_feedback ```</p>
<ul>
<li><p class="startli">The extra node <code>disp_goals_node</code> simple sends requests to the service server node <code>goal_info_srv_node</code> at the specified rate defined in the launch file (which can be set by the user, the same for the node <code>robo_info_node</code>) to get the number of goals reached or cancelled and prints them on the terminal. The simple class definition for the node is given below: ```cpp class <a class="el" href="class_goal_info_client.html" title="Classd defining the service client.">GoalInfoClient</a> { private: // Define the service client ros::ServiceClient goal_info_client; // Define the service message unige_rt1_assignment2::GoalInfo goal_info_srv;</p>
<p class="startli">public: <a class="el" href="class_goal_info_client.html" title="Classd defining the service client.">GoalInfoClient(ros::NodeHandle *n, double freq)</a> { // Set the frequency of the loop ros::Rate *loop_rate; loop_rate = new ros::Rate(freq);</p>
<p class="startli">// Create the service client goal_info_client = n-&gt;serviceClient&lt;unige_rt1_assignment2::GoalInfo&gt;("/goals_service");</p>
<p class="startli">while(ros::ok()) { // Call the service if (goal_info_client.call(goal_info_srv)) { ROS_INFO_STREAM(goal_info_srv.response.msg_feedback); } else { ROS_ERROR("Failed to call service /goals_service"); } // check for incoming messages ros::spinOnce(); // sleep for the time remaining loop_rate-&gt;sleep(); }</p>
<p class="startli">delete loop_rate; } }; ```</p>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md14"></a>
Programming style</h2>
<p>This package uses C++ classes for implementation of the ROS Nodes, since the use of classes not only provides structure and clarity to the code, but also aids in proper management of data and methods. We also avoid using unnecessary global variables in the code. The programs simply become more modular, with reusable chunks which are beneficial in larger projects.</p>
<h2><a class="anchor" id="autotoc_md15"></a>
Possible Improvements</h2>
<ul>
<li>The client console can be made even more robust, error-free and interactive, since some of the erroneous user-inputs have not been handled.</li>
<li>An interactive GUI on the console can be created.</li>
<li>Currently, there is no exit button / command, and the easiest way to exit simulation is using <code>Ctrl-C</code> on the main console, where <code>roslaunch</code> command is used. Better mechanism can be developed.</li>
</ul>
<h2><a class="anchor" id="autotoc_md16"></a>
Helpful references / documentation / answers:</h2>
<ul>
<li><a href="http://wiki.ros.org/actionlib/DetailedDescription">http://wiki.ros.org/actionlib/DetailedDescription</a></li>
<li><a href="http://docs.ros.org/en/api/actionlib_msgs/html/msg/GoalStatusArray.html">http://docs.ros.org/en/api/actionlib_msgs/html/msg/GoalStatusArray.html</a> </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
